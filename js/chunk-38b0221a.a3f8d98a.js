(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-38b0221a"],{"24fc":function(e,t,i){"use strict";var r=i("545e"),n=i.n(r);n.a},"365c":function(e,t,i){"use strict";i("99af");var r={serviceList:"/apioak/admin/services",creatService:"/apioak/admin/service",editService:function(e){return"/apioak/admin/service/".concat(e)},delService:function(e){return"/apioak/admin/service/".concat(e)},routersList:"/apioak/admin/routers",creatRouter:"apioak/admin/router",updateRouter:function(e){return"apioak/admin/router/".concat(e)},publishRouter:function(e,t){return"apioak/admin/router/".concat(e,"/env/").concat(t)},pluginList:"apioak/admin/plugins",saveServicePlugin:function(e){return"/apioak/admin/service/".concat(e,"/plugin")},delServicePlugin:function(e,t){return"/apioak/admin/service/".concat(e,"/plugin/").concat(t)},saveRouterPlugin:function(e){return"/apioak/admin/router/".concat(e,"/plugin")},delRouterPlugin:function(e,t){return"/apioak/admin/router/".concat(e,"/plugin/").concat(t)}};t["a"]=r},3730:function(e,t,i){"use strict";var r=i("f5be"),n=i.n(r);n.a},"545e":function(e,t,i){},efaa:function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"service"},[r("view-header",{attrs:{name:"服务"}}),r("div",{staticClass:"service-list"},[r("el-button",{staticClass:"service-add fl",attrs:{type:"primary"},on:{click:function(t){e.editId=0,e.drawer=!0,e.title="添加服务"}}},[e._v("新建服务")]),r("el-table",{staticClass:"service-table",attrs:{data:e.serviceList}},[r("el-table-column",{attrs:{width:"40px"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.plugins?r("div",[r("img",{staticStyle:{width:"24px",cursor:"pointer","vertical-align":"middle"},attrs:{src:i("6eed"),alt:"plugin"},on:{click:function(i){return e.showServicePlugins(t)}}})]):e._e()]}}])}),r("el-table-column",{attrs:{label:"服务名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-link",{attrs:{type:"primary"},on:{click:function(i){return e.goDetail(t)}}},[e._v(e._s(t.row.name))])]}}])}),r("el-table-column",{attrs:{label:"服务前缀",prop:"prefix"}}),r("el-table-column",{attrs:{label:"备注",prop:"desc"}}),r("el-table-column",{attrs:{label:"活动状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{staticStyle:{"margin-right":"12px"},attrs:{type:"primary",plain:"",size:"small"},on:{click:function(i){e.editService(t),e.drawer=!0,e.title="编辑服务"}}},[e._v("编辑")]),r("el-popover",{attrs:{width:"160",placement:"bottom"},model:{value:e.delPop[t.$index],callback:function(i){e.$set(e.delPop,t.$index,i)},expression:"delPop[scope.$index]"}},[r("p",[e._v("确认删除该服务吗？")]),r("div",{staticStyle:{"text-align":"right",margin:"0"}},[r("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(i){return e.cancel(t.$index)}}},[e._v("取消")]),r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){return e.delService(t.$index)}}},[e._v("确定")])],1),r("el-button",{attrs:{slot:"reference",type:"danger",plain:"",size:"small"},slot:"reference"},[e._v("删除")])],1)]}}])})],1)],1),r("el-drawer",{staticClass:"service-drawer",attrs:{title:e.title,visible:e.drawer,direction:e.direction,"with-header":!1,size:"50%"},on:{"update:visible":function(t){e.drawer=t}}},[r("p",{staticClass:"service-drawer_tit"},[r("span",{domProps:{innerHTML:e._s(e.title)}}),r("i",{staticClass:"el-icon-close fr",on:{click:function(t){e.drawer=!1}}})]),r("el-form",{ref:"ruleForm",staticClass:"service-form",attrs:{rules:e.rules,model:e.form,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"服务名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入服务名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),r("el-form-item",{attrs:{label:"URL前缀",prop:"prefix"}},[r("el-input",{attrs:{placeholder:"请输入服务前缀"},model:{value:e.form.prefix,callback:function(t){e.$set(e.form,"prefix",t)},expression:"form.prefix"}})],1),r("el-form-item",{attrs:{label:"备注",prop:"desc"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),r("el-row",{attrs:{gutter:24}},[r("el-col",{staticStyle:{"padding-top":"8px","font-size":"16px",color:"#606266","padding-right":"0"},attrs:{span:4}},[e._v("upstreams")]),r("el-col",{staticStyle:{"padding-left":"0"},attrs:{span:20}},[r("el-tabs",{staticClass:"service-tab",model:{value:e.activeEnv,callback:function(t){e.activeEnv=t},expression:"activeEnv"}},[r("el-tab-pane",{attrs:{label:"dev",name:"dev"}},[r("el-form-item",{attrs:{label:"环境域名",prop:"host"}},[r("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.form.upstreams.dev.host,callback:function(t){e.$set(e.form.upstreams.dev,"host",t)},expression:"form.upstreams.dev.host"}})],1),r("el-form-item",{attrs:{label:"Type",prop:"type"}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.upstreams.dev.type,callback:function(t){e.$set(e.form.upstreams.dev,"type",t)},expression:"form.upstreams.dev.type"}},[r("el-option",{attrs:{label:"roundrobin",value:"roundrobin"}}),r("el-option",{attrs:{label:"chash",value:"chash"}})],1)],1),r("el-form-item",{attrs:{label:"key",prop:"key"}},[r("el-input",{attrs:{type:"text",disabled:"roundrobin"==e.form.upstreams.dev.type,placeholder:"请输入内容"}})],1),r("el-form-item",{attrs:{inline:!0,label:"Node",prop:"node"}},e._l(e.form.upstreams.dev.nodes,(function(t,i){return r("div",{staticStyle:{"margin-bottom":"12px"}},[r("el-input",{staticClass:"node-item",attrs:{type:"text",placeholder:"IP"},model:{value:t.ip,callback:function(i){e.$set(t,"ip",i)},expression:"node.ip"}}),r("el-input",{staticClass:"node-item",attrs:{type:"text",placeholder:"Port"},model:{value:t.port,callback:function(i){e.$set(t,"port",e._n(i))},expression:"node.port"}}),r("el-input",{staticClass:"node-item",attrs:{type:"text",placeholder:"Weights"},model:{value:t.weight,callback:function(i){e.$set(t,"weight",e._n(i))},expression:"node.weight"}}),r("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:function(t){return e.addNode("dev")}}}),r("el-button",{attrs:{type:"danger",icon:"el-icon-remove-outline",disabled:1==e.form.upstreams.dev.nodes.length},on:{click:function(t){return e.delNode("dev",i)}}})],1)})),0)],1),r("el-tab-pane",{attrs:{label:"beta",name:"beta"}},[r("el-form-item",{attrs:{label:"环境域名",prop:"host"}},[r("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.form.upstreams.beta.host,callback:function(t){e.$set(e.form.upstreams.beta,"host",t)},expression:"form.upstreams.beta.host"}})],1),r("el-form-item",{attrs:{label:"Type",prop:"type"}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.upstreams.beta.type,callback:function(t){e.$set(e.form.upstreams.beta,"type",t)},expression:"form.upstreams.beta.type"}},[r("el-option",{attrs:{label:"roundrobin",value:"roundrobin"}}),r("el-option",{attrs:{label:"chash",value:"chash"}})],1)],1),r("el-form-item",{attrs:{label:"key",prop:"key"}},[r("el-input",{attrs:{type:"text",disabled:"roundrobin"==e.form.upstreams.beta.type,placeholder:"请输入内容"}})],1),r("el-form-item",{attrs:{inline:!0,label:"Node",prop:"node"}},e._l(e.form.upstreams.beta.nodes,(function(t,i){return r("div",{staticStyle:{"margin-bottom":"12px"}},[r("el-input",{staticClass:"node-item",attrs:{type:"text",placeholder:"IP"},model:{value:t.ip,callback:function(i){e.$set(t,"ip",i)},expression:"node.ip"}}),r("el-input",{staticClass:"node-item",attrs:{type:"text",placeholder:"Port"},model:{value:t.port,callback:function(i){e.$set(t,"port",e._n(i))},expression:"node.port"}}),r("el-input",{staticClass:"node-item",attrs:{type:"text",placeholder:"Weights"},model:{value:t.weight,callback:function(i){e.$set(t,"weight",e._n(i))},expression:"node.weight"}}),r("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:function(t){return e.addNode("beta")}}}),r("el-button",{attrs:{type:"danger",icon:"el-icon-remove-outline",disabled:1==e.form.upstreams.dev.nodes.length},on:{click:function(t){return e.delNode("beta",i)}}})],1)})),0)],1),r("el-tab-pane",{attrs:{label:"prod",name:"prod"}},[r("el-form-item",{attrs:{label:"环境域名",prop:"host"}},[r("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.form.upstreams.prod.host,callback:function(t){e.$set(e.form.upstreams.prod,"host",t)},expression:"form.upstreams.prod.host"}})],1),r("el-form-item",{attrs:{label:"Type",prop:"type"}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.upstreams.prod.type,callback:function(t){e.$set(e.form.upstreams.prod,"type",t)},expression:"form.upstreams.prod.type"}},[r("el-option",{attrs:{label:"roundrobin",value:"roundrobin"}}),r("el-option",{attrs:{label:"chash",value:"chash"}})],1)],1),r("el-form-item",{attrs:{label:"key",prop:"key"}},[r("el-input",{attrs:{type:"text",disabled:"roundrobin"==e.form.upstreams.prod.type,placeholder:"请输入内容"}})],1),r("el-form-item",{attrs:{inline:!0,label:"Node",prop:"node"}},e._l(e.form.upstreams.prod.nodes,(function(t,i){return r("div",{staticStyle:{"margin-bottom":"12px"}},[r("el-input",{staticClass:"node-item",attrs:{type:"text",placeholder:"IP"},model:{value:t.ip,callback:function(i){e.$set(t,"ip",i)},expression:"node.ip"}}),r("el-input",{staticClass:"node-item",attrs:{type:"text",placeholder:"Port"},model:{value:t.port,callback:function(i){e.$set(t,"port",e._n(i))},expression:"node.port"}}),r("el-input",{staticClass:"node-item",attrs:{type:"text",placeholder:"Weights"},model:{value:t.weight,callback:function(i){e.$set(t,"weight",e._n(i))},expression:"node.weight"}}),r("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:function(t){return e.addNode("prod")}}}),r("el-button",{attrs:{type:"danger",icon:"el-icon-remove-outline",disabled:1==e.form.upstreams.dev.nodes.length},on:{click:function(t){return e.delNode("prod",i)}}})],1)})),0)],1)],1)],1)],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.saveService}},[e._v("保存")]),r("el-button",{on:{click:function(t){e.drawer=!1}}},[e._v("取消")])],1)],1)],1),r("el-drawer",{staticClass:"service-drawer",attrs:{title:e.title,visible:e.pluginDrawer,direction:e.direction,"with-header":!1,size:"50%"},on:{"update:visible":function(t){e.pluginDrawer=t}}},[r("p",{staticClass:"service-drawer_tit"},[r("span",{domProps:{innerHTML:e._s(e.title)}}),r("i",{staticClass:"el-icon-close fr",on:{click:function(t){e.pluginDrawer=!1}}})]),e.showAddPlugins?e._e():r("el-button",{staticClass:"fr",staticStyle:{"margin-right":"32px"},attrs:{type:"primary",size:"small"},on:{click:e.addPlugin}},[e._v("添加")]),e.showAddPlugins?r("div",{staticStyle:{background:"#fafafa",padding:"12px"}},[r("h3",{staticStyle:{"font-size":"16px","font-weight":"bold","margin-bottom":"20px","margin-left":"12px"}},[e._v(e._s(e.pluginText))]),r("el-form",{ref:"pluginForm",attrs:{"label-width":"160px",rules:e.pluginRules,size:"small"},model:{value:e.pluginForm,callback:function(t){e.pluginForm=t},expression:"pluginForm"}},e._l(e.pluginParam,(function(t,i){return r("el-form-item",{key:i,attrs:{label:i}},["number"==t.type?r("span",[r("el-input-number",{attrs:{min:t.minimum},model:{value:e.pluginForm.config[i],callback:function(t){e.$set(e.pluginForm.config,i,t)},expression:"pluginForm.config[key]"}})],1):e._e(),"string"==t.type?r("span",[r("el-input",{attrs:{type:"text"},model:{value:e.pluginForm.config[i],callback:function(t){e.$set(e.pluginForm.config,i,t)},expression:"pluginForm.config[key]"}})],1):e._e(),"array"==t.type?r("span",[r("el-select",{model:{value:e.pluginForm.config[i],callback:function(t){e.$set(e.pluginForm.config,i,t)},expression:"pluginForm.config[key]"}},e._l(t.options,(function(e,t){return r("el-option",{key:"op"+t,attrs:{label:e,value:e}})})),1)],1):e._e()])})),1),r("div",{staticStyle:{"margin-left":"160px"}},[r("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:function(t){return e.savePlugin("pluginForm")}}},[e._v("提交")]),r("el-button",{attrs:{plain:"",size:"small"},on:{click:function(t){return e.cancelPlugin("pluginForm")}}},[e._v("取消")])],1)],1):e._e(),r("div",{staticStyle:{padding:"0 32px","margin-top":"24px"}},[r("el-table",{attrs:{data:e.curPluginsList}},[r("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-form",{staticClass:"table-expand",attrs:{"label-position":"left",size:"small"}},e._l(t.row,(function(t,i){return r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"name"!=i&&"desc"!=i,expression:"pluIndex !='name' && pluIndex != 'desc'"}],key:"serviceplugin"+i,attrs:{label:i}},[r("span",[e._v(e._s(t))])])})),1)]}}])}),r("el-table-column",{attrs:{label:"配置名称",prop:"name",width:"120px"}}),r("el-table-column",{attrs:{label:"描述",prop:"desc"}}),r("el-table-column",{attrs:{label:"操作",width:"160px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(i){return e.editPlugin(t)}}},[e._v("编辑")]),r("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:function(i){return e.delPlugin(t)}}},[e._v("删除")])]}}])})],1)],1)],1),r("el-dialog",{attrs:{title:"插件列表",visible:e.allPluginList},on:{"update:visible":function(t){e.allPluginList=t}}},[r("el-row",{attrs:{gutter:20}},e._l(e.pluginsList,(function(t,i){return r("el-col",{key:"plu"+i,staticStyle:{"margin-bottom":"20px"},attrs:{span:8}},[r("el-card",{staticClass:"plugin-card",attrs:{shadow:"hover"}},[r("h3",[e._v(e._s(t.name))]),r("p",[e._v(e._s(t.desc))]),r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(i){return e.getPluginParam(t)}}},[e._v("添加")])],1)],1)})),1)],1)],1)},n=[],s=(i("4160"),i("b0c0"),i("d3b7"),i("ac1f"),i("1276"),i("159b"),i("96cf"),i("365c")),a={name:"Service",data:function(){return{direction:"rtl",drawer:!1,pluginDrawer:!1,allPluginList:!1,pluginsList:[],pluginText:"",title:"添加服务",activeEnv:"dev",serviceList:[],serviceListIds:[],delPop:[],curPluginsList:[],editId:0,curServiceId:"",showAddPlugins:!1,form:{name:"",prefix:"",desc:"",upstreams:{prod:{host:"",type:"",nodes:[{port:"",ip:"",weight:""}]},dev:{host:"",type:"",nodes:[{port:"",ip:"",weight:""}]},beta:{host:"",type:"",nodes:[{port:"",ip:"",weight:""}]}}},pluginForm:{},pluginParam:{},rules:{name:[{required:!0,message:"请输入服务名称",trigger:"blur"}],prefix:[{required:!0,message:"请输入前缀",trigger:"blur"}],host:[{required:!0,message:"请输入host",trigger:"blur"}],type:[{required:!0,message:"请输入type",trigger:"blur"}]},pluginRules:{conn:[{required:!0,message:"必填",trigger:"blur"}],burst:[{required:!0,message:"必填",trigger:"blur"}],key:[{required:!0,message:"必填",trigger:"blur"}],default_conn_delay:[{required:!0,message:"必填",trigger:"blur"}]}}},created:function(){this.getServiceList()},methods:{getServiceList:function(){var e=this;this.$http.get(s["a"].serviceList).then((function(t){if(200==t.status){var i=[],r=[],n=[];t.data.nodes.forEach((function(e){e.value&&(i.push(e.value),r.push(e.key.split("/")[3]),n.push(!1))})),e.serviceList=i,e.serviceListIds=r,e.delPop=n}}))},saveService:function(){var e=this;this.editId?this.$http.put(s["a"].editService(this.editId),this.form).then((function(t){200==t.status&&(e.$message({type:"sucess",message:"编辑成功"}),e.getServiceList())})):this.$http.post(s["a"].creatService,this.form).then((function(t){201!=t.status&&200!=t.status||(e.$message({type:"sucess",message:"创建成功"}),e.getServiceList())}))},editService:function(e){this.form=e.row,this.editId=this.serviceListIds[e.$index]},delService:function(e){var t=this;this.editId=this.serviceListIds[e],this.$http.delete(s["a"].delService(this.editId)).then((function(e){200==e.status&&t.$message({type:"success",message:"删除成功"}),t.getServiceList()}))},addNode:function(e){this.upstreams["".concat(e)]["nodes"].push({port:"",ip:"",weight:""})},delNode:function(e,t){this.$delete(this.upstreams["".concat(e)]["nodes"],t)},cancel:function(e){this.$set(this.delPop,e,!1)},goDetail:function(e){this.$router.push({name:"serviceDetail",query:{id:this.serviceListIds[e.$index],name:e.row.name,tab:"api"}})},showServicePlugins:function(e){for(var t in this.curPluginsList=[],this.pluginDrawer=!0,this.curServiceId=this.serviceListIds[e.$index],e.row.plugins)e.row.plugins[t]["name"]=t,this.curPluginsList.push(e.row.plugins[t]);this.title="".concat(e.row.name," 插件列表")},addPlugin:function(){var e,t,i;return regeneratorRuntime.async((function(r){while(1)switch(r.prev=r.next){case 0:return this.allPluginList=!0,r.next=3,regeneratorRuntime.awrap(this.$http.get(s["a"].pluginList));case 3:e=r.sent,t=e.status,i=e.data,200==t&&(this.pluginsList=i);case 7:case"end":return r.stop()}}),null,this)},getPluginParam:function(e){var t,i;return regeneratorRuntime.async((function(r){while(1)switch(r.prev=r.next){case 0:for(i in this.pluginForm.key=e.key,this.showAddPlugins=!0,this.pluginText="添加 ".concat(e.key," 插件"),this.allPluginList=!1,this.pluginParam=e.parameter,t={},e.parameter)t[i]=e.parameter[i]["default"],t["desc"]=e.desc;this.$set(this.pluginForm,"config",t),this.$set(this.pluginForm,"key",e.key);case 9:case"end":return r.stop()}}),null,this)},editPlugin:function(e){var t,i,r,n,a,l=this;return regeneratorRuntime.async((function(o){while(1)switch(o.prev=o.next){case 0:return e.row,o.next=3,regeneratorRuntime.awrap(this.$http.get(s["a"].pluginList));case 3:if(t=o.sent,i=t.status,r=t.data,200==i){for(a in this.showAddPlugins=!0,this.pluginText="编辑 ".concat(e.row.name," 插件"),console.log(r),r.forEach((function(t,i){t.key==e.row.name&&(l.pluginParam=t.parameter)})),n={},e.row)"name"!=a&&(n[a]=e.row[a]);this.$set(this.pluginForm,"key",e.row.name),this.$set(this.pluginForm,"config",n)}case 7:case"end":return o.stop()}}),null,this)},cancelPlugin:function(e){this.showAddPlugins=!1},savePlugin:function(e){var t,i,r,n;return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(this.$http.post(s["a"].saveServicePlugin(this.curServiceId),this.pluginForm));case 2:if(t=e.sent,i=t.status,r=t.data,200==i){for(n in this.curPluginsList=[],r.value.plugins)r.value.plugins[n]["name"]=n,this.curPluginsList.push(r.value.plugins[n]);this.showAddPlugins=!1,this.pluginForm={}}case 6:case"end":return e.stop()}}),null,this)},delPlugin:function(e){var t=this;return regeneratorRuntime.async((function(i){while(1)switch(i.prev=i.next){case 0:this.$confirm("此操作将永久删除, 是否继续?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var i,r;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(t.$http.delete(s["a"].delServicePlugin(t.curServiceId,e.row.name)));case 2:i=n.sent,r=i.status,i.data,200==r&&(t.$message({type:"success",message:"".concat(e.row.name,"插件删除成功")}),t.$delete(t.curPluginsList,e.$index));case 6:case"end":return n.stop()}}))})).catch((function(){}));case 1:case"end":return i.stop()}}),null,this)}}},l=a,o=(i("3730"),i("24fc"),i("2877")),c=Object(o["a"])(l,r,n,!1,null,"41a6187f",null);t["default"]=c.exports},f5be:function(e,t,i){}}]);
//# sourceMappingURL=chunk-38b0221a.a3f8d98a.js.map